# -*- coding: utf-8 -*-
"""
Module to save the results of the Genetic Algorithm Application over London
Intention to save the numerous arrays generated by the genetic algorithm into
csv files for later use. 

So the module recieves the arrays in the form of the development plan:
    [0,0,60,100,...] and its susequent fitness values (45.3, 0.47, 92.0...)
So we need to process it so its saves the fitness values in seperate columns 
and then another column for the development plan. 
Fitness values need to be extracted individually I believe

Also taking the description and name of the array to put in the filename save.
Each results csv has a date/stamp saved on top line and within the filename 
"""

import numpy as np
import time

import datetime
# Create a datetime stamp for the results
ts = time.time()
date_time_stamp = datetime.datetime.fromtimestamp(ts).strftime('%y-%m-%d-%H-%M')



def ProcessArray(array,suffix):
    # Function which processes the array into a form that is suitable to be 
    # saved in a csv. So want each objective function seperate into columns
    # and one column which holds the development plan (ie [ 0,0,60,0...])
    count = 0    
    frmt_array = []
    for solution in array:
        count += 1
        frmt_sol = []
        sol_ref = suffix+str(count)
        frmt_sol.append(sol_ref)
        obj_func = solution.fitness.values
        for obj in obj_func:
            # for each objective function in the fitness, append it to 
            # new formatted solution.
            frmt_sol.append(obj)
        frmt_sol.append(solution)
        frmt_array.append(frmt_sol)
    return frmt_array
 
def SaveMultitoCsv(name, multi_array, Results_folder, suffix):
    # Process a series of arrays and save them individually    
    # Intended to save the results of the generational storage
    # So going to save each generations results in a csv
    
    # Track the generation to be saved
    gen_count = 0
    # Go through each generation
    for generation in multi_array:
        # Count so 
        gen_count+=1
        name = ("Generation_"+str(gen_count))
        SavetoCsv(name,generation, Results_folder,suffix+str(gen_count))
                
    print "Written ", gen_count, " Generation CSVs"     

def SavetoCsv(name, array, Results_folder, suffix):
    # Process the array into a form to save to a csv
    Processed_Array =ProcessArray(array,suffix)

    
    # using the csv module to save the list to a csv. the numpy savetxt didnt
    # work as its several arrays in the list. 
    import csv
    with open(Results_folder+name+".csv", "wb") as f:
        writer = csv.writer(f)
        
        # Define a header and write it to the first line of the csv     
        header = ([["Results of GA over London run on "+date_time_stamp]])
        writer.writerows(header)
        
        # write the column headers and write it to the next line
        # Note: consider a way of
        column_headers=([['Sol_Ref', r'$f_{heat} $',r'$f_{flood} $',r'$f_{brownfield} $',r'$f_{density} $', 'development plan']])        
        writer.writerows(column_headers)
        
        # Write the proecessed array
        writer.writerows(Processed_Array)  
        print "Written "+name+" CSV"